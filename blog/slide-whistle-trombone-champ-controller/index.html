<!doctype html>
<html lang="en">
  <head>
    <link rel="shortcut icon" type="image/png" href="../../assets/img/favicon.png" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta
      property="og:title"
      content="Slidey Doots: Slide whistle as
Trombone Champ controller"
    />
    <meta
      property="og:description"
      content="Write-up on making a
wireless controller for the video game Trombone Champ out of a slide
whistle"
    />
    <meta property="og:url" content="https://www.hannahilea.com/blog/slide-whistle-trombone-champ-controller" />
    <meta property="og:image" content="https://www.hannahilea.com/blog/slide-whistle-trombone-champ-controller/assets/thumbnail.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="300" />
    <meta property="og:image:height" content="300" />
    <meta property="og:type" content="website" />

    <title>Slidey Doots: Slide whistle as Trombone Champ controller</title>
    <link rel="stylesheet" type="text/css" href="../../assets/css/main.css" />
  </head>

  <body>
    <div class="main-container blog">
      <nav class="navbar" role="navigation">
        @hannahilea:
        <a class="nav-link" href="../..">home</a> | <a class="nav-link" href="../../projects">projects</a> |
        <a class="nav-link" href="..">blog</a>
      </nav>
      <h1>Slidey Doots: Slide whistle as Trombone Champ controller</h1>
      <p>My initial response to the 2022 video game <a href="https://www.trombonechamp.com/">Trombone Champ</a> was a simple HELL. YES.</p>
      <div class="centered-children">
        <iframe
          width="560"
          height="315"
          src="https://www.youtube-nocookie.com/embed/9o-3brNQOns?si=kh8EYeq9a8eiRQqs"
          title="YouTube video player"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen
        >
        </iframe>
      </div>
      <p>
        Upon playing it myself, I found that my joy in the game was blunted by the disconnect of controlling the trombone via computer trackpad. I yearned for the physical slidyness experienced by a true trombone god!<a
          href="#fn1"
          class="footnote-ref"
          id="fnref1"
          role="doc-noteref"
          ><sup>1</sup></a
        >
        How, I wondered, could I easily and cheaply manifest a physical slide with which to control the game? Enter: the humble slide whistle.
      </p>
      <p>Here is my submission to the Trombone Champ DIY controller pantheon—(optionally) wireless, (relatively) easy to replicate, and (indisputably) slide-y:</p>
      <figure>
        <img src="assets/ballgame-1.gif" alt="Animated image of Trombone Champ game being played by slide whistle" />
      </figure>
      <p>This project was co-built with Alex Ferguson, who managed the circuitry and assembly.</p>
      <p>
        <em
          >NB: This is one of those projects that I started, didn’t touch for a year, and then recently picked up to finish—and in that time, Trombone Champ released a Nintendo Switch variant and a virtual reality variant, both of which
          provide slidier control options for game play than those available when I started. I’ve also seen <a href="https://www.reddit.com/r/trombonechamp/comments/xq54hn/comment/iq7g8i8/">3D printed controllers</a> as well as some
          <a href="https://www.youtube.com/watch?v=uzNMawGSed8">made from real trombones</a>. Excellent! The more Trombone Champ, the merrier.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></em
        >
      </p>
      <h3 id="design">Design</h3>
      <p>In addition to the non-negotiable slidyness, I had two requirements:</p>
      <ol type="1">
        <li>Must be relatively cheap and easy to build, and therefore relatively cheap and easy for anyone else to replicate.</li>
        <li>
          Must not be gross when sharing amongst multiple players, i.e., should not involve players actually putting their mouths on the instrument<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>
        </li>
      </ol>
      <p>Based on the game’s user inputs, the new controller needed to support two input parameters:</p>
      <ol type="1">
        <li>
          <strong>Slide position / output pitch</strong>, a continuous value that correlates to the slide position of a trombone. In the original game, this is controlled by the y-dimension of cursor movement (i.e., up/down but not side to
          side) from either a trackpad or a mouse.
        </li>
        <li>
          <strong>Playing sound vs not playing sound</strong>, a binary value that simulates a musician blowing air through the trombone. In the original game, this is controlled by either clicking (and holding down) a mouse button or any
          arbitrary key on the keyboard. (If you trigger the “playing sound” state for too long, the in-game player runs out of air.)
        </li>
      </ol>
      <p>
        Because Trombone Champ takes basic mouse input as its default controller, it was straightforward to set up the new controller as a mouse, and to interact with the game by sending its sensor commands to the computer packaged as mouse
        commands.
      </p>
      <h3 id="physical-components">Physical components</h3>
      <ul>
        <li>
          <p>
            <strong>Microcontroller</strong>: <a href="https://www.adafruit.com/product/4062">Adafruit Feather Express</a>, running a program written in CircuitPython (described below); attached to the whistle body, and powered by a basic
            external USB power brick.
          </p>
        </li>
        <li>
          <p><strong>Slide position sensor</strong>: <a href="https://www.adafruit.com/product/4219">linear slide potentiometer</a>, attached to the whistle body with its knob coupled to the whistle slide with hot glue.</p>
        </li>
        <li>
          <p><strong>Breath on/off sensor</strong>: basic momentary button, attached to the whistle body near the mouthpiece.</p>
          <p>The use of button for this control is…fine. It’s not my top choice, and I’d love to replace it with something that feels more natural to play.</p>
          <p>
            What I’d <em>really</em> wanted is for this parameter to be breath-controlled, and I considered putting a cheap microphone on/in the whistle mouthpiece. However, Requirement 2 presented a reality check: as a musician, I know how
            gross it is to swap instruments around a group of people, and how annoying it is to have to clean a mouthpiece with rubbing alcohol before passing it along to someone else to play. I couldn’t envision a sanitary way of setting
            up a microphone on the whistle in a way that would be both playable and wouldn’t encourage putting one’s mouth directly on/around the mouthpiece of the whistle. There are of course other ways to sense breath, but couldn’t come
            up with something that met the design goals at the same time. To be left for a future improvement!
          </p>
          <p>For now, I went with a basic button. I don’t love it, but it is perfectly serviceable. I think something breath-based would be nicer, and I think this button is the weakest part of the controller, spiritually. :)</p>
        </li>
      </ul>
      <h3 id="assembly">Assembly</h3>
      <p>We first hooked up the components in a breadboard, to test the overall circuitry. It worked!</p>
      <div class="centered-children">
        <iframe
          width="560"
          height="315"
          src="https://www.youtube-nocookie.com/embed/YGRgp6Z2gFY?si=B6oVh24c1DM2jR_2"
          title="YouTube video player"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen
        >
        </iframe>
      </div>
      <p>
        Once we’d confirmed our circuit functionality, we attached the Feather and components to the whistle with a sophisticated combination of Blu Tack and embroidery thread—to keep the flat backs of the components stable on the round
        body of the whistle.
      </p>
      <p>We then did the requisite soldering, and topped the whole shebang off with some strategically placed electrical tape. Classy!</p>
      <figure>
        <img src="assets/progress-1.jpg" alt="Photo of slide whistle with some electronics attached, held in a pair of electronics Helping Hands" />
      </figure>
      <p>
        Finally, we coupled the slide potentiometer’s knob to the slide of the whistle with hot glue. Perhaps we’ll make a cleaned-up version in the future.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>
      </p>
      <figure>
        <img src="assets/progress-3.jpg" alt="Photo of completed slide whistle controller" />
      </figure>
      <p>
        Our circuit is slightly fancier than it needed to be, as the resistors we added in series with the button and slide potentiometer inadvertantly duplicated the pull-up resistors built into the Feather, which can be enabled in code
        (<code>button.pull = Pull.UP</code>). I didn’t realize that until after we’d soldered in our external resistors, however. Ah well, no harm no foul!
      </p>
      <h2 id="programming">Programming</h2>
      <p>
        I used <a href="https://learn.adafruit.com/ble-hid-keyboard-buttons-with-circuitpython/ble-keyboard-buttons">this Adafruit tutorial</a> as a starting point for sending sensor inputs as HID mouse commands over Bluetooth.
        CircuitPython libraries for both HID and Bluetooth made this setup fairly straightforward.
      </p>
      <p>The pseudocode for the run loop is something like this:</p>
      <pre><code># Setup 
slide_potentiometer = connect_to_analog_pin(1)
button = connect_to_digital_pin(2)
hid = setup_mouse_controller()

def map_voltage_to_screen_min_max(v): 
    ...

# Run loop 
while True:
    y_previous = 0
    button_is_pressed = False
    
    ...wait to connect to bluetooth...

    while bluetooth_connected():
        # Handle slide behavior
        slide_voltage = slide_potentiometer.get_voltage()
        y_now = map_voltage_to_screen_min_max(slide_voltage)

        # The library expects a *relative* mouse movement, not an absolute one
        hid.send_mouse_y_update(y_previous - y_now)
        y_previous = y_now

        # Handle click behavior 
        button_state = button.get_value() # Returns true/false 
        if button_state != button_is_pressed:
            if button_state:
                hid.send_mouse_left_button_down()
            else:
                hid.send_mouse_left_button_up()
            button_is_pressed = button_state
</code></pre>
      <p>
        The full script is <a href="https://github.com/hannahilea/slide-whistle-trombone-champ-controller/blob/main/code.py">here</a>. There’s some extra functionality in the actual implementation to disable sending mouse commands from the
        controller if the onboard Feather button has been pressed, but otherwise the pseudocode is basically it.
      </p>
      <p>
        The trickiest part of the software implementation was something I didn’t end up needing to write at all: because of how we’d put the Feather in the breadboard, our connection between the input pins and the sensors was tenuous at
        best, which lead to a voltage jump in the potentiometer while the button was pressed. At the time we didn’t realize that the cause was the breadboard/Feather connection, so I thought I was going to have to program around it, and
        spent a fair amount of time thinking about how I might do that (definitely doable, just an annoying exercise in bookkeeping!). Then as soon as we soldered everything together we discovered that the jump was gone, and figured out
        that the breadboard connection had been tenuous. Huzzah!
      </p>
      <h2 id="bring-on-the-doots">Bring on the doots!</h2>
      <p>Once the Feather is connected to the external power, it automatically broadcasts itself as an available Bluetooth peripheral that can be connected to via any computer.</p>
      <p>If you move the slide back and forth now, the mouse travels up and down the screen. Once you open Trombone Champ (e.g., via Steam), you’ll be good to play!</p>
      <p>First, a little warm up:</p>
      <iframe
        width="560"
        height="315"
        src="https://www.youtube-nocookie.com/embed/6XEAdTrbz-Y?si=tGdmMPXLZWzWpgj_"
        title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen
      >
      </iframe>
      <p>And now let’s really get into it!</p>
      <iframe
        width="560"
        height="315"
        src="https://www.youtube-nocookie.com/embed/WTBGyS3Lx18?si=ORa5NRcX_1GndPz7"
        title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen
      >
      </iframe>
      <p>
        I find the slide whistle controller significantly more fun to play, and more fun to watch others play, than the default mouse controls. Additionally, you can get up and move around as the music moves you.<a
          href="#fn5"
          class="footnote-ref"
          id="fnref5"
          role="doc-noteref"
          ><sup>5</sup></a
        >
      </p>
      <p>
        It’s still tricky to play the game well. Of our several playtesters, our resident trumpet player (Alex) picked up the slide controller much more quickly than either our flute-playing friend or I did, but we all struggled. As
        compared to a real trombone, the slide whistle has a significantly smaller range of motion, AND there are more discrete slide positions required (one per chromatic note!) as compared to a real trombone. That said, it’s no harder to
        play than the default mouse or trackpad!
      </p>
      <p>Of course, you don’t need to have Trombone Champ open for the controller to function—you can also, e.g., scroll a website that way. Did we do this? Absolutely. :joy:</p>
      <iframe
        width="560"
        height="315"
        src="https://www.youtube-nocookie.com/embed/BGke6a0LoaE?si=KIGE497RJ9ZR3Wn1"
        title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen
      >
      </iframe>
      <h2 id="discussion">Discussion</h2>
      <p>
        This was a relatively easy project, all things considered—I chalk that up to a relatively small scope of the task and the existence of Adafruit tutorials.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"
          ><sup>6</sup></a
        >
        I thought it was going to be a much bigger lift, but once I realized that I could “just” treat the controller as a mouse input, everything fell into place nicely.
      </p>
      <p>
        One side benefit of this particular project is that now that I know how we built <em>this</em> Bluetooth HID via CircuitPython and external sensors, I’ve been able to pattern-map onto other projects, and basically handle the
        electronics and hardware pieces by myself. I’m learning! :D It feels good.
      </p>
      <p>Future work, if I decide to spend more time on this project:</p>
      <ul>
        <li>Making a slightly more nicely-packaged version of the whistle+electronics</li>
        <li>Adding an “auto-tune” mode that snaps the slide movements to discrete pitches, which would make it easier to play intelligible tunes with less practice (but might be less fun…?)</li>
        <li>Diagnosing and fixing the slight lag that shows up occasionally, which I suspect is related to the controller being connected over Bluetooth.</li>
        <li>
          Building a MIDI mode that sends out MIDI commands instead of mouse movements—which has been inadvertantly assumed/requested by other folks throwing out their own cool “what if you did ___” follow-up ideas—so that the controller
          can be used as a MIDI slide whistle.
        </li>
      </ul>
      <p>Do you have follow-up ideas? Do you know me IRL and want to play some doots? Let me know!</p>
      <p>
        <strong
          ><em
            >The code for this controller—including set-up instructions—is available <a href="https://github.com/hannahilea/slide-whistle-trombone-champ-controller">on GitHub</a>. Thanks to MC and SS for playtesting, WT for putting up with
            us playtesting, and <a href="https://www.holywowstudios.com/">Holy Wow Studios</a> for creating this <del>cursed</del> delightful game.</em
          ></strong
        >
      </p>
      <section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
        <hr />
        <h3 id="footnotes-title">Footnotes</h3>
        <ol>
          <li id="fn1">
            <p>For the record, I am a flute/sax player, not a brass player, so this is purely speculation on my part.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p>
          </li>
          <li id="fn2">
            <p>Bystanders, roommates, and pets may disagree.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p>
          </li>
          <li id="fn3">
            <p>Have you <em>seen</em> brass players clear the spit from their instruments?! It’s gross, yo.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p>
          </li>
          <li id="fn4">
            <p>
              Disclaimer on her behalf: Alex wanted to make it a much more professional, beautifully wired version of this controller, but I convinced her that it was a quasi-hacky prototype so string and electrical tape and visibly
              disorganized wires were totally fine for now. I take full responsibility for its current lack of polish!<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a>
            </p>
          </li>
          <li id="fn5">
            <p>Both for musicality moves and wincing moves!<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p>
          </li>
          <li id="fn6">
            <p>I have spent <em>so</em> much time perusing Adafruit tutorials this year. Truly one of the great knowledge repositories of our time.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p>
          </li>
        </ol>
      </section>
      <hr />
      <ul>
        <li>Created: 2025-1-09</li>
        <li>Last updated: 2025-1-09</li>
        <li>Type: project-write-up</li>
        <li>Tags: interactive, programming, gaming, hardware, doofy</li>
      </ul>
    </div>
  </body>
</html>
